# 5.12 Amazon Bedrock - RAG & Knowledge Base - Complete Setup - Hands On

So here we go.We're going to set up RAGand a knowledge base on Amazon Bedrock.Now this hands-on is a bit more complicatedthan the other one.So you've learned what you needto know from a knowledge base perspective.This is just technical stuff if you are very curiousinto how things works.So to create a knowledge base, we needto move away from what's called a root user.This is a root user right now we're connected to,we just see the account ID and we go into an IAM user.So you type IAM in your servicesand then you go to the IAM consoleand you're going to go under usersand you're going to create a user.The username is whatever you want.I'm going to name it Stephane,and I'm going to provide user accessto the AWS management console.Now I knowthat the recommended user type is here in identity center.This is something we'll see later on.Right now I wanna make it super simple.So I want to just create an IAM userand then you can use a custom password that you must know,and I'm going to just enter a password that I know.So here I go,and I'm good to go.Okay, and then we can untick this.I don't need to create a new password at login.Then let's click on next.And we're going to attach policies directly.And the one we're looking for is administrator access.So we're going to give full admin power to this user.Then we click on next and then create user.And our user is successfully created.Now we have an access to a console sign-in URLwith a username and our password.So let's go into the sign-in URL right now and press enter.And now we have this new sign-in page.So the account ID we'll leave as is,the username is whatever you had before,and then the password is your actual password.And then click on sign in.So here we go, now I am into the console.And I know that I am logged in using the IAM userbecause well it says IAM user Stefan,and there is my account ID.So now we're ready to go back into Amazon Bedrockand then get started.Go on the left hand side onto knowledge basesand create a knowledge base.So the knowledge base name we'll just leave it as is.The IAM permissions,we're going to select create and use a new service role.So we leave the defaults, then we choose Amazon S3,and then we can see actually the options we have.So we have Amazon S3,but we can also have other data sourcessuch as a web crawler to extract data from the webpage.Or it could be third party data sources such as Confluence,where you can store your informationor Salesforce for your own CRMor SharePoint to have a look at your documents hostedon SharePoint.But we'll use Amazon S3 right now in our little PDF file.Let's click on next.And next we need to create a data source.So it's going to be Amazon S3 on this account.And we need to select an S3 bucket.So now let's go into Amazon S3and actually create an S3 bucket.So we're going to create a bucketand we need to make sure we are in US East one still.And it's a general purpose type of bucket,and you just have to give it a name.So my demo bucket knowledge base Stephane,and you see this name is very longand complicated because if you just enter a namethat is already taken, for example test,and then you click on create buckets,you're going to get an error saying,hey, this bucket name already exists.So the bucket name doesn't exist in my account,but it exists in someone else's account.And so this is a problem on Amazon S3, the bucket name needsto be unique and therefore you need to enter a unique name.So if you copy this entire bucket name, it's not goingto work because I have created this bucket myself.So choose a name that is going to be unique to you.Then you scroll all the way down, we don't need anyof these options and we create this bucket.So now my bucket is createdand I'm going to just click on itand within it, this is where we can upload objects.So let's upload a first object is going to be our evolutionof the internet detailed and click on upload.So it's a very simple interfaceto upload files onto the cloud.And now if we look at it in our bucket,we have one object, which is our PDF.So this is great, and now I just go into,back into Amazon Bedrock and we need to select an S3 URI.So we browse Amazon S3, we refresh this, doesn't work, okay,so let's cancel this, refreshand recreate the knowledge base.We scroll down, click on next, and then click on browse S3.And here we go, now we can select this Amazon S3 bucket.So we choose it and now this is filled.So next we go click on next,we need to select an embeddings model.So this is how to convert your data into a vector.So different options here,but I'm just going to take the one from Amazon,this Titan Text Embeddings V2,and we don't touch anything on the vector dimension.Now for the vector database.So we have several options.If you wanted to go all the way free,then you would select Pineconebecause Pinecone, if you go on the website of Pinecone,so pinecone.io, and you go on the pricing,you see that there is a free tier.So you can start freeand you can have up to two gigabytes of storageand then write units and read units all the way,you're good.So this is a setup I'm not going to dobecause I'm trying to demonstrate the AWS servicesof course, but if you wanted to stay free,I would recommend Pinecone.Now I'm going to pay some money for what I'm goingto do right now, but I'm going to do a quick createwith a new vector storebecause this is going to use Amazon OpenSearch Serverless,which is an AWS service,and something they most likely want you to use.Other services on AWS for example is Amazon Aurora.But so we're going to do a quick createof a new vector store and actually you can seethat even though they say it's cost efficient,I really don't believe it.So for Amazon OpenSearch Serverless pricing, it's usedby computing OCU and you have a minimum billableof two OCUs and OCUs are quite expensive,so you get $0.24 per OCU per hour,which is around $172 per month.So it's quite expensive,and then you also pay for the storage.And so what I wanna say is that we are goingto be conscious in this courseand make sure that we delete OpenSearch Serviceright after using it.So we'll pay a minimal amountif you do the hands-on with me.Again, good for you to know.And if you follow along and you create a vector storewith me on Amazon OpenSearch Serverless,you are going to pay some money.So please don't forget to delete things.Otherwise this is going to be a very sad moment.Okay, so let's click on create knowledge baseand now we're good to go.Again, you will get an errorif you're not using an IAM user.So this was very important to do.So this will take a little bit of timeand I'm going to pause the video until we are done.Okay, so my knowledge base is now createdand I can click on go to data sources to have a look at it.So it says that yes, my data source is availableand then what I'm going to do is click on itand then sync it to perform a synchronization of the datathat I have in my S3 bucket to my database in OpenSearch.So as you can see here, I can click on OpenSearch serviceand have a look at it and confirmthat on the left hand side under dashboard I have accessto my collection, which is my Bedrock Knowledge Base.So it's pretty cool.So I wanna show you a little bit how this works.This is obviously way advanced knowledge,but I'm always curious.So if you click on this collection,you can see right here that we have access to our endpointand we have an OpenSearch dashboard URL that we can look atto look at what's within our collection.And we can have a look as well at indexes to seethat an index was created.And there is one vector with six documents.So if we go into OpenSearch Dashboards,and here we are so we can visualize our data.So to do it, we go on the left hand side under discover,and then you have index pattern.So we click on create index pattern,and then we paste this nameof the index in here, click on next step,and then create index pattern.This is to, we can tell OpenSearch Dashboards to lookfor our data, and here we can see all the fieldsthat were created automatically by Amazon Bedrock.So this is very handy.Now let's go in here and go here.We click on dashboards, we go, sorry, into discover.And then we can have a look here into our knowledge base.And here we have access to the actual vectors.So this is some information around what was the text chunkof my PDF that is in here, what is the ID?And then what is the actual Bedrock knowledge base vector?And so all these numbers were createdby the embeddings model.So this is advanced, I know,but I wanna show you the deep down things of how it works.Basically my document was chunked,and then for each chunk a vector was created.And so you have about one, two, three, four, five,six chunks right now for my documents.But by the way, now I can go into Amazon Bedrockand I can start testing my knowledge base.So let's configure a model.We're going to take, for example, again,anthropic haiku or sonnet, let's apply it, perfect.And here we're gonna say, who invented the worldwide web,click on run.And then is going to retrieve and generate a response.As you can see, we have pretty muchthe same answer as before.And in terms of sources, we can see that now we have a linkto evolution of the internet detailed point PDF.And if I click on it, this takes me directly into Amazon S3into my PDF file that I have uploaded.So it's quite cool because now we have set up a full RAGand if you wanted to set up properly,you would add more documentsof course in your Amazon S3 bucket,and then you would click on the sync button.So here we've practiced how to use RAG,so I'm going to clean it up.And to do so, I delete the knowledge base.So click on delete, and it's goingto delete the knowledge base,but this doesn't delete your OpenSearch database.So let's wait for this to be done.And next, so this was very quick, and next,let's go into OpenSearch Service.And under here for this collection,you're going to delete it.Otherwise this will incur some cost in the long run.So that's it, we've practiced creatingan OpenSearch serverless database.We have created a knowledge base,we've uploaded some files onto Amazon S3.You can keep your S3 bucket running, this is fine.This is not going to cost you anything.And then we were able to demonstratehow knowledge bases and RAG works.So I'm very excited, this was a long hands-onand very advanced I know, but good to see.I hope you liked it, and I will see you in the next lecture.